<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>8BIT Upbit Bot UI</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    body{background:#0b1220;color:#ffffff;font-family:-apple-system, Segoe UI, Roboto, 'Noto Sans KR', Arial, sans-serif;font-size:14px}
    .card{background:#1e2329;border:1px solid rgba(255,255,255,0.08)}
    #tvChart{width:100%;height:82vh;min-height:460px}
    .kv{display:flex;justify-content:space-between;padding:.5rem 0;border-bottom:1px dashed rgba(255,255,255,0.08)}
    .buy{color:#0ecb81}.sell{color:#f6465d}
    @media (max-width: 991px){ #tvChart{height:70vh} }
    .toolbar .form-control,.toolbar .form-select{color:#ffffff;background:#2b3139;border:1px solid rgba(255,255,255,0.2)}
    .toolbar .btn{color:#ffffff}
    .form-check-label{color:#e0e7ff}
    .kv span:first-child{color:#ffffff}
    .kv span:last-child{color:#ffffff;font-weight:700}
    .badge{color:#ffffff}
    .text-muted{color:#ffffff !important}
    /* Assets UI */
    .asset-stat{background:#0e1424;border:1px solid rgba(255,255,255,0.1);border-radius:8px;padding:10px}
    .asset-stat .label{color:#ffffff;font-size:12px}
    .asset-stat .value{color:#ffffff;font-size:20px;font-weight:700}
    .asset-bars{display:flex;flex-direction:column;gap:8px}
    .asset-bar .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .asset-bar .label{color:#ffffff;font-weight:600}
    .asset-bar .muted{color:#ffffff;font-size:12px;margin-left:8px}
    .asset-bar .meter{height:10px;border-radius:6px;background:#10182a;overflow:hidden;border:1px solid rgba(255,255,255,0.08)}
    .asset-bar .fill{height:100%;background:linear-gradient(90deg,#0ecb81,#2bdab5)}
    .asset-bar.krw .fill{background:linear-gradient(90deg,#4285f4,#72a6ff)}
    .chip{display:inline-block;padding:3px 8px;margin:2px;border-radius:999px;background:#2b3139;border:1px solid rgba(255,255,255,0.12);font-size:12px;color:#ffffff}
    /* Win list */
    #winList{display:flex;flex-direction:column;gap:6px;overflow:hidden}
    .win-chip{display:flex;flex-direction:column;align-items:flex-start;gap:4px;text-align:left;border:1px solid rgba(255,255,255,0.15);border-radius:8px;padding:6px 10px;color:#ffffff;background:#1b2437;transition:transform .2s ease, box-shadow .2s ease;min-height:32px}
    .win-chip.positive{background:linear-gradient(90deg,rgba(14,203,129,0.35),rgba(14,203,129,0.10));}
    .win-chip.negative{background:linear-gradient(90deg,rgba(246,70,93,0.35),rgba(246,70,93,0.10));}
    .win-chip:hover{transform:translateY(-1px); box-shadow:0 4px 10px rgba(0,0,0,0.35)}
    .win-chip .meta{font-size:12px;color:#d9e2f3;white-space:nowrap}
    .win-chip .val{font-weight:700;white-space:normal;word-break:break-word;flex:1}
    /* PnL slider glow */
    @keyframes glowGreen { 0%{ box-shadow:0 0 0 rgba(14,203,129,0);} 50%{ box-shadow:0 0 12px rgba(14,203,129,0.8);} 100%{ box-shadow:0 0 0 rgba(14,203,129,0);} }
    @keyframes glowRed { 0%{ box-shadow:0 0 0 rgba(246,70,93,0);} 50%{ box-shadow:0 0 12px rgba(246,70,93,0.8);} 100%{ box-shadow:0 0 0 rgba(246,70,93,0);} }
    .glow-green{ animation: glowGreen .9s ease; }
    .glow-red{ animation: glowRed .9s ease; }
    #pnlLeftLabel,#pnlRightLabel{ color:#ffffff }
  </style>
</head>
<body>
  <div class="container-xxl py-3">
    <!-- Global Profit/Loss slider (uses Win% from backtest) -->
    <div class="card border-secondary rounded-3 p-2 mb-3">
      <div class="pnl-track" style="height:14px; background:#0e1424; border:1px solid rgba(255,255,255,0.12); border-radius:10px; overflow:hidden; position:relative">
        <div id="pnlCenter" style="position:absolute; left:50%; top:0; width:2px; height:100%; background:#ffffff"></div>
        <div id="pnlLeftBar" style="position:absolute; right:50%; top:0; height:100%; width:0%; background:linear-gradient(90deg, rgba(14,203,129,0.9), rgba(14,203,129,0.45)); transition:width .6s ease"></div>
        <div id="pnlRightBar" style="position:absolute; left:50%; top:0; height:100%; width:0%; background:linear-gradient(90deg, rgba(246,70,93,0.45), rgba(246,70,93,0.9)); transition:width .6s ease"></div>
      </div>
      <div class="d-flex justify-content-between mt-1" style="font-size:12px">
        <div id="pnlLeftLabel">Profit 0%</div>
        <div id="pnlRightLabel">Loss 100%</div>
      </div>
    </div>
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="m-0">8BIT Upbit Bot - Chart</h3>
      <div class="text-muted" id="meta">-</div>
    </div>

    <!-- Top Status + Layout switch: chart left, assets right -->
    <div class="row g-3 align-items-stretch mb-3">
      <div class="col-12 col-lg-2">
        <div class="card border-secondary rounded-3 p-3 h-100 d-flex flex-column">
          <div class="mb-2"><strong>Win%</strong></div>
          <div id="winList" class="flex-grow-1"></div>
          <div class="mt-2 d-flex justify-content-end">
            <button id="winClear" class="btn btn-sm btn-outline-light">Clear</button>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-7">
        <div class="card border-secondary rounded-3 h-100"><div class="card-body"><div id="tvChart" class="mt-2"></div></div></div>
      </div>
      <div class="col-12 col-lg-3">
        <div class="card border-secondary rounded-3 p-3 h-100">
          <div class="d-flex justify-content-between align-items-center">
            <div><strong>Assets</strong> <span id="assetsMeta" class="text-muted"></span> <span id="mlCount" class="text-muted"></span></div>
            <div>
              <button id="assetsRefresh" class="btn btn-sm btn-outline-light">Refresh</button>
              <div class="form-check form-switch d-inline-block ms-2">
                <input class="form-check-input" type="checkbox" id="assetsAuto" checked>
                <label class="form-check-label text-muted" for="assetsAuto">Auto</label>
              </div>
            </div>
          </div>
          <div class="mt-2">
            <div class="asset-stat"><div class="label">총 자산(추정 KRW)</div><div id="assetTotal" class="value">-</div></div>
            <div class="asset-stat mt-2"><div class="label">매수 가능(KRW)</div><div id="assetBuyable" class="value">-</div></div>
            <div class="asset-stat mt-2"><div class="label">매도 가능</div><div id="assetSellable" style="margin-top:4px"></div></div>
            <div id="assetsBars" class="asset-bars mt-3"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-3 justify-content-center">
      <div class="col-12 mt-3">
        <div class="card border-secondary rounded-3 p-3">
          <div class="row g-2 align-items-center mb-3 toolbar">
            <div class="col-auto">
              <select id="timeframe" class="form-select form-select-sm">
                <option value="minute1">1m</option>
                <option value="minute3">3m</option>
                <option value="minute5">5m</option>
                <option value="minute10" selected>10m</option>
                <option value="minute15">15m</option>
                <option value="minute30">30m</option>
                <option value="minute60">1h</option>
                <option value="day">1D</option>
              </select>
            </div>
            <div class="col-auto"><button id="botStart" class="btn btn-primary btn-sm">Start Bot</button></div>
            <div class="col-auto"><button id="botStop" class="btn btn-outline-light btn-sm">Stop Bot</button></div>
            <div class="col-auto"><button id="btnShot" class="btn btn-secondary btn-sm">Screenshot</button></div>
            <div class="col-auto"><button id="btnBacktest" class="btn btn-outline-info btn-sm">Backtest</button></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="autoBtToggle">
              <label class="form-check-label text-muted" for="autoBtToggle">Auto BT</label>
            </div>
            <div class="col-auto text-muted">sec</div>
            <div class="col-auto"><input id="autoBtSec" type="number" value="60" min="10" step="10" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto"><button id="btnOptimize" class="btn btn-success btn-sm">Auto-Tune NB</button></div>
            <div class="col-auto"><button id="btnTrain" class="btn btn-warning btn-sm">Train (Auto Period)</button></div>
            <div class="col-auto text-muted">Cnt</div>
            <div class="col-auto"><input id="trainCount" type="number" value="1800" min="300" step="300" class="form-control form-control-sm" style="width:90px" /></div>
            <div class="col-auto text-muted">Seg</div>
            <div class="col-auto"><input id="trainSeg" type="number" value="3" min="2" step="1" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto"><button id="btnMlTrain" class="btn btn-danger btn-sm">ML Train</button></div>
            <div class="col-auto"><button id="btnMlPredict" class="btn btn-outline-danger btn-sm">ML Predict</button></div>
            <div class="col-12 col-lg-4">
              <div class="card border-secondary rounded-3 p-2 text-white" style="min-height:80px">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <strong>Model Insight</strong>
                  <span id="miZone" class="badge bg-secondary">-</span>
                </div>
                <div id="miText" class="text-white" style="font-size:12px; color:#e6eefc">-</div>
              </div>
            </div>
            <div class="col-auto"><button id="btnMlMetrics" class="btn btn-outline-warning btn-sm">ML Metrics</button></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="mlAuto">
              <label class="form-check-label text-muted" for="mlAuto">ML Auto</label>
            </div>
            <div class="col-auto text-muted">N</div>
            <div class="col-auto"><input id="mlRandN" type="number" value="12" min="1" step="1" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto"><button id="btnMlRandom" class="btn btn-outline-warning btn-sm">ML Random</button></div>
            <div class="col-auto"><button id="btnClearOrders" class="btn btn-outline-danger btn-sm">Clear Orders</button></div>
            <div class="col-auto text-muted">NB Window</div>
            <div class="col-auto"><input id="nbWindow" type="number" value="100" min="20" step="10" class="form-control form-control-sm" style="width:90px" /></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="nbToggle" checked>
              <label class="form-check-label text-muted" for="nbToggle">Show NB</label>
            </div>
            <div class="col-12"></div>
            <div class="col-auto text-muted">BUY≥r</div>
            <div class="col-auto"><input id="nbBuyTh" type="number" value="0.70" min="0.5" max="0.95" step="0.01" class="form-control form-control-sm" style="width:80px" /></div>
            <div class="col-auto text-muted">SELL≤r</div>
            <div class="col-auto"><input id="nbSellTh" type="number" value="0.30" min="0.05" max="0.5" step="0.01" class="form-control form-control-sm" style="width:80px" /></div>
            <div class="col-auto text-muted">Pullback%</div>
            <div class="col-auto"><input id="nbPullback" type="number" value="40" min="10" max="80" step="1" class="form-control form-control-sm" style="width:80px" /></div>
            <div class="col-auto text-muted">Debounce</div>
            <div class="col-auto"><input id="nbDebounce" type="number" value="6" min="0" max="20" step="1" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto text-muted">Forecast</div>
            <div class="col-auto"><input id="fcWindow" type="number" value="50" min="10" step="5" class="form-control form-control-sm" style="width:80px" /></div>
            <div class="col-auto"><input id="fcHorizon" type="number" value="30" min="1" step="1" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="fcToggle" checked>
              <label class="form-check-label text-muted" for="fcToggle">Show</label>
            </div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="ordersToggle">
              <label class="form-check-label text-muted" for="ordersToggle">Show Orders</label>
            </div>
            <div class="col-auto text-muted">Paper</div>
            <div class="col-auto">
              <select id="paperMode" class="form-select form-select-sm">
                <option value="true" selected>true</option>
                <option value="false">false</option>
              </select>
            </div>
            <div class="col-auto text-muted">Order KRW</div>
            <div class="col-auto"><input id="orderKrw" type="number" value="5000" min="1000" step="1000" class="form-control form-control-sm" style="width:110px" /></div>
            <div class="col-auto text-muted">EMA</div>
            <div class="col-auto"><input id="emaFast" type="number" value="10" class="form-control form-control-sm" style="width:80px" /></div>
            <div class="col-auto">/</div>
            <div class="col-auto"><input id="emaSlow" type="number" value="30" class="form-control form-control-sm" style="width:80px" /></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="emaFilter" checked>
              <label class="form-check-label text-muted" for="emaFilter">EMA Filter</label>
            </div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="nbFromEma">
              <label class="form-check-label text-muted" for="nbFromEma">NB from EMA</label>
            </div>
            <div class="col-auto text-muted">NB EMA</div>
            <div class="col-auto"><input id="nbEmaPeriod" type="number" value="10" min="2" step="1" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-12"></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="showSMA" checked>
              <label class="form-check-label text-muted" for="showSMA">SMA</label>
            </div>
            <div class="col-auto text-muted">50</div>
            <div class="col-auto"><input id="sma50" type="number" value="50" min="5" step="5" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto text-muted">100</div>
            <div class="col-auto"><input id="sma100" type="number" value="100" min="10" step="5" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto text-muted">200</div>
            <div class="col-auto"><input id="sma200" type="number" value="200" min="20" step="10" class="form-control form-control-sm" style="width:70px" /></div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="showEMA9" checked>
              <label class="form-check-label text-muted" for="showEMA9">EMA 9/12/26</label>
            </div>
            <div class="col-auto text-muted">Ichimoku</div>
            <div class="col-auto form-check form-switch">
              <input class="form-check-input" type="checkbox" id="showIchimoku">
              <label class="form-check-label text-muted" for="showIchimoku">Tenkan/Kijun</label>
            </div>
            <div class="col-auto text-muted">9</div>
            <div class="col-auto"><input id="ichiTenkan" type="number" value="9" min="5" step="1" class="form-control form-control-sm" style="width:60px" /></div>
            <div class="col-auto text-muted">26</div>
            <div class="col-auto"><input id="ichiKijun" type="number" value="26" min="10" step="1" class="form-control form-control-sm" style="width:60px" /></div>
          </div>
          <hr class="text-secondary"/>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <strong class="text-white">실시간 로그</strong>
            <div>
              <button id="btnClearLog" class="btn btn-sm btn-outline-light me-2">Clear</button>
              <div class="form-check form-switch d-inline-block">
                <input class="form-check-input" type="checkbox" id="logAutoscroll" checked>
                <label class="form-check-label text-muted" for="logAutoscroll">Auto</label>
              </div>
            </div>
          </div>
          <pre id="logBox" style="height:160px;overflow:auto;background:#0e1424;border:1px solid rgba(255,255,255,0.1);border-radius:6px;padding:8px;margin:0;color:#a7b4d7;font-size:12px;line-height:1.35"></pre>
          <div id="mlMetricsBox" class="mt-2" style="font-size:12px;color:#e6eefc"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Orders Log Bottom Section -->
  <div class="row g-3 justify-content-center mt-3">
    <div class="col-12">
      <div class="card border-secondary rounded-3 p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <strong>주문 로그</strong>
          <div>
            <button id="btnOrderExport" class="btn btn-sm btn-outline-light me-2">Export CSV</button>
            <button id="btnOrderClear" class="btn btn-sm btn-outline-danger">Clear</button>
          </div>
        </div>
        <div id="orderLog" style="height:180px;overflow:auto;background:#0e1424;border:1px solid rgba(255,255,255,0.1);border-radius:6px;padding:8px;margin:0;color:#e6eefc;font-size:12px;line-height:1.35"></div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="/static/ui.js?v=dev"></script>
</body>
</html>


